<!doctype html>
<html lang="ko" class="antialiased">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Excel Pivot Visualizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-white text-gray-800">
  <div id="app" class="min-h-screen flex flex-col">
    <header class="p-4 border-b bg-gradient-to-r from-indigo-500 to-cyan-400 text-white">
      <div class="container mx-auto">
        <h1 class="text-2xl font-semibold">엑셀 피벗 대시보드</h1>
      </div>
    </header>

    <main class="container mx-auto p-4 flex-1">
      <div class="mb-4">
        <nav class="flex space-x-4" aria-label="Tabs">
          <button id="tab-data" class="tab-btn px-4 py-2 bg-indigo-50 rounded-md dark:bg-gray-800">[1] 자료 수집</button>
          <button id="tab-chart" class="tab-btn px-4 py-2">[2] 차트 설정/수정</button>
        </nav>
      </div>

      <section id="panel-data" class="tab-panel">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="col-span-1 md:col-span-1 space-y-3">
            <label class="block">엑셀 파일 업로드</label>
            <input id="file" type="file" accept=".xlsx,.xls" class="w-full" />
            <label>시트 선택</label>
            <select id="sheetSelect" class="w-full border rounded"></select>
              <div>
                <label>Available Fields</label>
                <div id="fieldList" class="mt-2 max-h-40 overflow-auto border rounded p-2 bg-white"></div>
            </div>
          </div>

          <div class="col-span-1 md:col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label>X-axis (최대 2)</label>
                <select id="xSelect" multiple size="4" class="w-full border rounded"></select>
              </div>
              <div>
                <label>Y-axis (최대 2)</label>
                <select id="ySelect" multiple size="4" class="w-full border rounded"></select>
              </div>
            </div>
            <div class="mt-3 flex items-center gap-3">
              <label>집계</label>
              <select id="aggSelect" class="border rounded p-1">
                <option value="none">none</option>
                <option value="sum">sum</option>
                <option value="mean">mean</option>
                <option value="count">count</option>
                <option value="min">min</option>
                <option value="max">max</option>
              </select>
              <label>차트 타입</label>
              <select id="chartType" class="border rounded p-1">
                <option value="scatter">분산(Scatter)</option>
                <option value="line">선(Line)</option>
                <option value="bar">막대(Bar)</option>
                <option value="area">영역(Area)</option>
              </select>
              <button id="renderBtn" class="ml-auto px-4 py-2 bg-indigo-600 text-white rounded">그래프 그리기 (matplotlib 스타일)</button>
              <button id="downloadImage" class="px-3 py-2 border rounded">고해상도 저장</button>
            </div>
            <div class="mt-4">
              <div id="plot" class="w-full h-96 bg-white rounded shadow"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="panel-chart" class="hidden">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="col-span-1 md:col-span-1 space-y-3 max-h-[600px] overflow-y-auto">
            <h3 class="font-semibold sticky top-0 bg-white z-10 py-2">세부 설정</h3>
            <div class="space-y-2">
              <!-- 축 설정 -->
              <details class="p-2 border rounded bg-white" open>
                <summary class="font-medium cursor-pointer">축 (Axis)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="block">차트 제목</label>
                    <input id="chartTitle" class="w-full border rounded p-1" placeholder="차트 제목 (선택)">
                  </div>
                  <div>
                    <label class="block">X축 제목</label>
                    <input id="xTitle" class="w-full border rounded p-1" placeholder="X축 제목">
                  </div>
                  <div>
                    <label class="block">Y축 제목</label>
                    <input id="yTitle" class="w-full border rounded p-1" placeholder="Y축 제목">
                  </div>
                  <div>
                    <label class="block">X축 최소값</label>
                    <input id="xMin" type="number" class="w-full border rounded p-1" placeholder="자동">
                  </div>
                  <div>
                    <label class="block">X축 최대값</label>
                    <input id="xMax" type="number" class="w-full border rounded p-1" placeholder="자동">
                  </div>
                  <div>
                    <label class="block">Y축 최소값</label>
                    <input id="yMin" type="number" class="w-full border rounded p-1" placeholder="자동">
                  </div>
                  <div>
                    <label class="block">Y축 최대값</label>
                    <input id="yMax" type="number" class="w-full border rounded p-1" placeholder="자동">
                  </div>
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="yLog" type="checkbox" class="w-4 h-4"> 로그 스케일
                    </label>
                  </div>
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="xReverse" type="checkbox" class="w-4 h-4"> X축 반전
                    </label>
                  </div>
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="yReverse" type="checkbox" class="w-4 h-4"> Y축 반전
                    </label>
                  </div>
                </div>
              </details>

              <!-- 눈금선 설정 -->
              <details class="p-2 border rounded bg-white">
                <summary class="font-medium cursor-pointer">눈금선 (Gridlines)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="block">눈금선 색상</label>
                    <input id="gridColor" type="color" value="#cccccc" class="w-full border rounded p-1">
                  </div>
                  <div>
                    <label class="block">선 너비</label>
                    <input id="gridWidth" type="number" min="0.5" max="5" step="0.5" value="1" class="w-full border rounded p-1">
                  </div>
                  <div>
                    <label class="block">투명도 (%)</label>
                    <input id="gridOpacity" type="number" min="0" max="100" value="30" class="w-full border rounded p-1">
                  </div>
                  <div>
                    <label class="block">대시 스타일</label>
                    <select id="gridDash" class="w-full border rounded p-1">
                      <option value="solid">실선</option>
                      <option value="dot">점선</option>
                      <option value="dash">대시</option>
                      <option value="dashdot">대시-점</option>
                    </select>
                  </div>
                </div>
              </details>

              <!-- 범례 설정 -->
              <details class="p-2 border rounded bg-white">
                <summary class="font-medium cursor-pointer">범례 (Legend)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="block">위치</label>
                    <select id="legendPos" class="w-full border rounded p-1">
                      <option value="top-right">상-우</option>
                      <option value="top-left">상-좌</option>
                      <option value="bottom-right">하-우</option>
                      <option value="bottom-left">하-좌</option>
                      <option value="outside">차트 밖</option>
                    </select>
                  </div>
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="legendShowLegend" type="checkbox" checked class="w-4 h-4"> 범례 표시
                    </label>
                  </div>
                </div>
              </details>

              <!-- 계열 서식 -->
              <details class="p-2 border rounded bg-white">
                <summary class="font-medium cursor-pointer">계열 서식 (Series)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="block">선 색상</label>
                    <input id="seriesColor" type="color" value="#1f77b4" class="w-full border rounded p-1">
                  </div>
                  <div>
                    <label class="block">선 너비</label>
                    <input id="lineWidth" type="number" min="0.5" max="5" step="0.5" value="2" class="w-full border rounded p-1">
                  </div>
                  <div>
                    <label class="block">마커 모양</label>
                    <select id="markerSymbol" class="w-full border rounded p-1">
                      <option value="circle">원형</option>
                      <option value="square">사각형</option>
                      <option value="diamond">마름모</option>
                      <option value="cross">십자</option>
                      <option value="x">X</option>
                      <option value="triangle-up">삼각형-위</option>
                      <option value="triangle-down">삼각형-아래</option>
                      <option value="star">별</option>
                    </select>
                  </div>
                  <div>
                    <label class="block">마커 크기</label>
                    <input id="markerSize" type="number" min="1" max="30" value="8" class="w-full border rounded p-1">
                  </div>
                  <div>
                    <label class="block">마커 색상</label>
                    <input id="markerColor" type="color" value="#1f77b4" class="w-full border rounded p-1">
                  </div>
                </div>
              </details>

              <!-- 오차 막대 -->
              <details class="p-2 border rounded bg-white">
                <summary class="font-medium cursor-pointer">오차 막대 (Error Bars)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="errorBarsEnabled" type="checkbox" class="w-4 h-4"> 오차 막대 표시
                    </label>
                  </div>
                  <div>
                    <label class="block">방향</label>
                    <select id="errorDirection" class="w-full border rounded p-1" disabled>
                      <option value="y">Y축</option>
                      <option value="x">X축</option>
                    </select>
                  </div>
                  <div>
                    <label class="block">오차 유형</label>
                    <select id="errorType" class="w-full border rounded p-1" disabled>
                      <option value="fixed">고정값</option>
                      <option value="percent">백분율 (%)</option>
                      <option value="stdev">표준편차</option>
                      <option value="sterror">표준오차</option>
                    </select>
                  </div>
                  <div>
                    <label class="block">오차량</label>
                    <input id="errorValue" type="number" step="0.1" value="1" class="w-full border rounded p-1" disabled placeholder="예: 0.5 또는 10%">
                  </div>
                </div>
              </details>

              <!-- 추세선 -->
              <details class="p-2 border rounded bg-white">
                <summary class="font-medium cursor-pointer">추세선 (Trendline)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="trendlineEnabled" type="checkbox" class="w-4 h-4"> 추세선 표시
                    </label>
                  </div>
                  <div>
                    <label class="block">타입</label>
                    <select id="trendlineType" class="w-full border rounded p-1" disabled>
                      <option value="linear">선형</option>
                      <option value="poly">다항식</option>
                      <option value="exp">지수</option>
                      <option value="log">로그</option>
                    </select>
                  </div>
                  <div>
                    <label class="block">다항식 차수</label>
                    <input id="trendlineDegree" type="number" min="1" max="5" value="2" class="w-full border rounded p-1" disabled placeholder="2~5">
                  </div>
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="trendlineShowEq" type="checkbox" class="w-4 h-4" disabled> 수식 표시
                    </label>
                  </div>
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="trendlineShowR2" type="checkbox" checked class="w-4 h-4" disabled> R² 값 표시
                    </label>
                  </div>
                  <div>
                    <label class="block">선 색상</label>
                    <input id="trendlineColor" type="color" value="#ff7f0e" class="w-full border rounded p-1" disabled>
                  </div>
                  <div>
                    <label class="block">선 너비</label>
                    <input id="trendlineWidth" type="number" min="0.5" max="5" step="0.5" value="2" class="w-full border rounded p-1" disabled>
                  </div>
                </div>
              </details>

              <!-- 데이터 레이블 -->
              <details class="p-2 border rounded bg-white">
                <summary class="font-medium cursor-pointer">데이터 레이블 (Data Labels)</summary>
                <div class="mt-2 space-y-2 text-sm">
                  <div>
                    <label class="inline-flex items-center gap-2">
                      <input id="dataLabelsEnabled" type="checkbox" class="w-4 h-4"> 데이터 값 표시
                    </label>
                  </div>
                  <div>
                    <label class="block">반올림 소수점</label>
                    <input id="dataLabelsDecimals" type="number" min="0" max="5" value="2" class="w-full border rounded p-1" disabled placeholder="0~5">
                  </div>
                  <div>
                    <label class="block">폰트 크기</label>
                    <input id="dataLabelsFontSize" type="number" min="8" max="24" value="12" class="w-full border rounded p-1" disabled>
                  </div>
                  <div>
                    <label class="block">폰트 색상</label>
                    <input id="dataLabelsFontColor" type="color" value="#000000" class="w-full border rounded p-1" disabled>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <div class="col-span-1 md:col-span-2">
            <h3 class="font-semibold">차트 미리보기</h3>
            <div id="plot2" class="w-full h-[520px] bg-white rounded shadow"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
  <script src="app_advanced.js"></script>
</body>
</html>
