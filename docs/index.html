<!doctype html>
<html lang="ko" class="antialiased">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Excel Pivot Visualizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-white text-gray-800 dark:bg-gray-900 dark:text-gray-100">
  <div id="app" class="min-h-screen flex flex-col">
    <header class="p-4 border-b bg-gradient-to-r from-indigo-500 to-cyan-400 text-white dark:from-gray-800 dark:to-gray-700">
      <div class="container mx-auto flex items-center justify-between">
        <h1 class="text-2xl font-semibold">엑셀 피벗 대시보드</h1>
        <div class="flex items-center gap-3">
          <label class="flex items-center gap-2"><input id="darkToggle" type="checkbox" class="form-checkbox"> 다크 모드</label>
          <button id="exportJson" class="px-3 py-1 bg-white text-indigo-600 rounded">설정 저장</button>
          <button id="importJsonBtn" class="px-3 py-1 border rounded">설정 불러오기</button>
        </div>
      </div>
    </header>

    <main class="container mx-auto p-4 flex-1">
      <div class="mb-4">
        <nav class="flex space-x-4" aria-label="Tabs">
          <button id="tab-data" class="tab-btn px-4 py-2 bg-indigo-50 rounded-md dark:bg-gray-800">[1] 자료 수집</button>
          <button id="tab-chart" class="tab-btn px-4 py-2">[2] 차트 설정/수정</button>
        </nav>
      </div>

      <section id="panel-data" class="tab-panel">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="col-span-1 md:col-span-1 space-y-3">
            <label class="block">엑셀 파일 업로드</label>
            <input id="file" type="file" accept=".xlsx,.xls" class="w-full" />
            <label>시트 선택</label>
            <select id="sheetSelect" class="w-full border rounded"></select>
            <div>
              <label>Available Fields</label>
              <div id="fieldList" class="mt-2 max-h-40 overflow-auto border rounded p-2 bg-white dark:bg-gray-800"></div>
            </div>
          </div>

          <div class="col-span-1 md:col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label>X-axis (최대 2)</label>
                <select id="xSelect" multiple size="4" class="w-full border rounded"></select>
              </div>
              <div>
                <label>Y-axis (최대 2)</label>
                <select id="ySelect" multiple size="4" class="w-full border rounded"></select>
              </div>
            </div>
            <div class="mt-3 flex items-center gap-3">
              <label>집계</label>
              <select id="aggSelect" class="border rounded p-1">
                <option value="none">none</option>
                <option value="sum">sum</option>
                <option value="mean">mean</option>
                <option value="count">count</option>
              </select>
              <label>차트 타입</label>
              <select id="chartType" class="border rounded p-1">
                <option value="scatter">분산(Scatter)</option>
                <option value="line">선(Line)</option>
                <option value="bar">막대(Bar)</option>
                <option value="area">영역(Area)</option>
              </select>
              <button id="renderBtn" class="ml-auto px-4 py-2 bg-indigo-600 text-white rounded">차트 렌더</button>
              <button id="downloadImage" class="px-3 py-2 border rounded">고해상도 저장</button>
            </div>
            <div class="mt-4">
              <div id="plot" class="w-full h-96 bg-white rounded shadow dark:bg-gray-800"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="panel-chart" class="hidden">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="col-span-1 md:col-span-1 space-y-3">
            <h3 class="font-semibold">세부 설정</h3>
            <div class="space-y-2">
              <details class="p-2 border rounded bg-white dark:bg-gray-800">
                <summary class="font-medium">축 (Axis)</summary>
                <div class="mt-2 space-y-2">
                  <label>X축 제목</label>
                  <input id="xTitle" class="w-full border rounded p-1">
                  <label>Y축 제목</label>
                  <input id="yTitle" class="w-full border rounded p-1">
                  <label>로그 스케일</label>
                  <input id="yLog" type="checkbox" class="ml-2">
                </div>
              </details>

              <details class="p-2 border rounded bg-white dark:bg-gray-800">
                <summary class="font-medium">눈금선</summary>
                <div class="mt-2 space-y-2">
                  <label>눈금선 색상</label>
                  <input id="gridColor" type="color" value="#cccccc">
                </div>
              </details>

              <details class="p-2 border rounded bg-white dark:bg-gray-800">
                <summary class="font-medium">범례 (Legend)</summary>
                <div class="mt-2 space-y-2">
                  <label>위치</label>
                  <select id="legendPos" class="w-full border rounded p-1"><option value="top">상</option><option value="right">우</option><option value="bottom">하</option><option value="left">좌</option></select>
                </div>
              </details>

              <details class="p-2 border rounded bg-white dark:bg-gray-800">
                <summary class="font-medium">계열 서식 (Series)</summary>
                <div class="mt-2 space-y-2">
                  <label>선 색상</label>
                  <input id="seriesColor" type="color" value="#1f77b4">
                  <label>마커 모양</label>
                  <select id="markerSymbol" class="w-full border rounded p-1"><option>circle</option><option>square</option><option>diamond</option><option>cross</option></select>
                  <label>마커 크기</label>
                  <input id="markerSize" type="number" min="1" max="30" value="8" class="w-full border rounded p-1">
                </div>
              </details>
            </div>
            <div class="mt-3 space-y-2">
              <button id="saveConfig" class="w-full px-3 py-2 bg-green-600 text-white rounded">설정 JSON으로 저장</button>
              <input id="loadConfig" type="file" accept="application/json" class="w-full mt-1">
            </div>
          </div>

          <div class="col-span-1 md:col-span-2">
            <h3 class="font-semibold">차트 미리보기</h3>
            <div id="plot2" class="w-full h-[520px] bg-white rounded shadow dark:bg-gray-800"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
